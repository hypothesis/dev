<html>
    <head>
        <style>
            body {
                padding: 20px;
                font-family: sans-serif;
            }

            h1 {
                margin-bottom: 0.2em;
            }

            /* Form */

            input, select {font-size: 0.9em;}
            textarea {width: 40em;}
            option.bad {color:red;}

            button {
                padding: 5px 10px;
                font-size: 1.1em;
            }

            label {
                display: block;
                padding: 10px 0 5px;
            }

            /* URL display */

            iframe {
                width: 100%;
                height:500px;
            }
        </style>
    </head>

    <body>
        <h1>Via Test Harness</h1>
        {% if not via_urls %}
            <p>Make sure you have filled out the secrets in '<code>config.json</code>'.</p>
        {% endif %}
        <form>
            <label for="app">Application</label>
            <select name="app">
                {% for app_name, values in config.apps.items() %}
                    {% set no_secret = not config.secrets[values.env] %}
                    <option
                            value="{{ app_name }}"
                            {% if app_name == app %}selected{% endif %}
                            {% if no_secret %}class="bad"{% endif %}>
                        {{ app_name }}
                        {% if no_secret %}
                            ⚠ No secret configured ⚠
                        {% endif %}
                    </option>
                {% endfor %}
            </select>
             <button type="submit">Go</button>
            <label for="url" >URL to proxy</label>
            <textarea rows="5" type="text" name="urls">{{ urls }}</textarea>


        </form>

        {% if via_urls %}
            <ul>
                {% for url in via_urls %}
                    <li><a href="{{ url }}">{{ url | truncate(120) }}</a></li>
                {% endfor %}
            </ul>

            {% if via_urls | length == 1 %}
                <iframe src="{{ via_urls[0] }}"></iframe>
            {% endif %}
        {% endif %}
    </body>
</html>